

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>btgym.algorithms package &mdash; BTGym 0.0.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BTGym 0.0.6 documentation" href="index.html"/>
        <link rel="next" title="btgym.research package" href="btgym.research.html"/>
        <link rel="prev" title="btgym.datafeed package" href="btgym.datafeed.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> BTGym
          

          
          </a>

          
            
            
              <div class="version">
                0.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Package Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#environment-engine-description">Environment engine description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#data-flow-structure">Data flow structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#a3c-framework-description">A3C framework description</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.envs.html">btgym.envs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html">btgym.dataserver module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.server">btgym.server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.spaces">btgym.spaces module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.strategy.html">btgym.strategy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.monitor.html">btgym.monitor package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.rendering.html">btgym.rendering package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.datafeed.html">btgym.datafeed package</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">btgym.algorithms package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#btgym-algorithms-launcher-module">btgym.algorithms.launcher module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-btgym.algorithms.worker">btgym.algorithms.worker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-algorithms-aac-module">btgym.algorithms.aac module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-algorithms-policy-module">btgym.algorithms.policy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-algorithms-losses-module">btgym.algorithms.losses module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-algorithms-nn-utils-module">btgym.algorithms.nn_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-btgym.algorithms.rollout">btgym.algorithms.rollout module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-btgym.algorithms.memory">btgym.algorithms.memory module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-btgym.algorithms.envs">btgym.algorithms.envs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-btgym.algorithms.runner">btgym.algorithms.runner module</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.research.html">btgym.research package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BTGym</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>btgym.algorithms package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/btgym.algorithms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="btgym-algorithms-package">
<h1>btgym.algorithms package<a class="headerlink" href="#btgym-algorithms-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="btgym-algorithms-launcher-module">
<h2>btgym.algorithms.launcher module<a class="headerlink" href="#btgym-algorithms-launcher-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-btgym.algorithms.worker">
<span id="btgym-algorithms-worker-module"></span><h2>btgym.algorithms.worker module<a class="headerlink" href="#module-btgym.algorithms.worker" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="btgym.algorithms.worker.Worker">
<em class="property">class </em><code class="descclassname">btgym.algorithms.worker.</code><code class="descname">Worker</code><span class="sig-paren">(</span><em>env_config</em>, <em>policy_config</em>, <em>trainer_config</em>, <em>cluster_spec</em>, <em>job_name</em>, <em>task</em>, <em>log_dir</em>, <em>log_level</em>, <em>max_env_steps</em>, <em>random_seed=None</em>, <em>test_mode=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/worker.html#Worker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.worker.Worker" title="Permalink to this definition">¶</a></dt>
<dd><p>Distributed tf worker class.</p>
<p>Sets up environment, trainer and starts training process in supervised session.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>env_config</strong> – environment class_config_dict.</li>
<li><strong>policy_config</strong> – model policy estimator class_config_dict.</li>
<li><strong>trainer_config</strong> – algorithm class_config_dict.</li>
<li><strong>cluster_spec</strong> – tf.cluster specification.</li>
<li><strong>job_name</strong> – worker or parameter server.</li>
<li><strong>task</strong> – integer number, 0 is chief worker.</li>
<li><strong>log_dir</strong> – for tb summaries and checkpoints.</li>
<li><strong>log_level</strong> – int, logbook.level</li>
<li><strong>max_env_steps</strong> – number of environment steps to run training on</li>
<li><strong>test_mode</strong> – if True - use Atari mode, BTGym otherwise.</li>
<li><strong>Note</strong> – <ul>
<li><dl class="first docutils">
<dt>Conventional <cite>self.global_step</cite> refers to number of environment steps,</dt>
<dd>summarized over all environment instances, not to number of policy optimizer train steps.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Every worker can run several environments in parralell, as specified by <a href="#id1"><span class="problematic" id="id2">`</span></a>cluster_config’[‘num_envs’].</dt>
<dd>If use 4 forkers and num_envs=4 =&gt; total number of environments is 16. Every env instance has
it’s own ThreadRunner process.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>When using replay memory, keep in mind that every ThreadRunner is keeping it’s own replay memory,</dt>
<dd>If memory_size = 2000, num_workers=4, num_envs=4 =&gt; total replay memory size equals 32 000 frames.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="btgym.algorithms.worker.Worker.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/worker.html#Worker.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.worker.Worker.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Worker runtime body.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="btgym-algorithms-aac-module">
<h2>btgym.algorithms.aac module<a class="headerlink" href="#btgym-algorithms-aac-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="btgym-algorithms-policy-module">
<h2>btgym.algorithms.policy module<a class="headerlink" href="#btgym-algorithms-policy-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="btgym-algorithms-losses-module">
<h2>btgym.algorithms.losses module<a class="headerlink" href="#btgym-algorithms-losses-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="btgym-algorithms-nn-utils-module">
<h2>btgym.algorithms.nn_utils module<a class="headerlink" href="#btgym-algorithms-nn-utils-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-btgym.algorithms.rollout">
<span id="btgym-algorithms-rollout-module"></span><h2>btgym.algorithms.rollout module<a class="headerlink" href="#module-btgym.algorithms.rollout" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="btgym.algorithms.rollout.make_data_getter">
<code class="descclassname">btgym.algorithms.rollout.</code><code class="descname">make_data_getter</code><span class="sig-paren">(</span><em>queue</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#make_data_getter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.make_data_getter" title="Permalink to this definition">¶</a></dt>
<dd><p>Data stream getter constructor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>queue</strong> – instance of <cite>Queue</cite> class to get rollouts from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">callable, returning dictionary of data.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="btgym.algorithms.rollout.Rollout">
<em class="property">class </em><code class="descclassname">btgym.algorithms.rollout.</code><code class="descname">Rollout</code><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout" title="Permalink to this definition">¶</a></dt>
<dd><p>Experience rollout as [nested] dictionary of lists of ndarrays, tuples and rnn states.</p>
<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>values</em>, <em>_struct=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds single experience frame to rollout.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>values</strong> – [nested] dictionary of values.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.add_memory_sample">
<code class="descname">add_memory_sample</code><span class="sig-paren">(</span><em>sample</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.add_memory_sample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.add_memory_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Given replay memory sample as list of experience-dictionaries of <cite>length</cite>,
converts it to rollout of same <cite>length</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>gamma</em>, <em>gae_lambda=1.0</em>, <em>size=None</em>, <em>time_flat=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts single-trajectory rollout of experiences to dictionary of ready-to-feed arrays.
Computes rollout returns and the advantages.
Pads with zeroes to desired length, if size arg is given.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gamma</strong> – discount factor</li>
<li><strong>gae_lambda</strong> – GAE lambda</li>
<li><strong>size</strong> – if given and time_flat=False, pads outputs with zeroes along <a href="#id3"><span class="problematic" id="id4">`</span></a>time’ dim. to exact ‘size’.</li>
<li><strong>time_flat</strong> – reduce time dimension to 1 step by stacking all experiences along batch dimension.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>[1, time_size, depth] or [1, size, depth] if not time_flatten and <cite>size</cite> is not/given, with single
<cite>context</cite> entry for entire trajectory, i.e. of size [1, context_depth];</p>
<p>[batch_size, 1, depth], if time_flatten, with batch_size = time_size and <cite>context</cite> entry for
every experience frame, i.e. of size [batch_size, context_depth].</p>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">batch as [nested] dictionary of np.arrays, tuples and LSTMStateTuples. of size</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.process_rp">
<code class="descname">process_rp</code><span class="sig-paren">(</span><em>reward_threshold=0.1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.process_rp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.process_rp" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes rollout process()-alike and estimates reward prediction target for first n-1 frames.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reward_threshold</strong> – reward values such as <a href="#id5"><span class="problematic" id="id6">|r|</span></a>&gt; reward_threshold are classified as neg. or pos.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Processed batch with size reduced by one and with extra <cite>rp_target</cite> key
holding one hot encodings for classes {zero, positive, negative}.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.get_frame">
<code class="descname">get_frame</code><span class="sig-paren">(</span><em>idx</em>, <em>_struct=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.get_frame"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.get_frame" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts single experience from rollout.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>idx</strong> – experience position</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">frame as [nested] dictionary</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.rollout.Rollout.pop_frame">
<code class="descname">pop_frame</code><span class="sig-paren">(</span><em>idx</em>, <em>_struct=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/rollout.html#Rollout.pop_frame"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.rollout.Rollout.pop_frame" title="Permalink to this definition">¶</a></dt>
<dd><p>Pops single experience from rollout.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>idx</strong> – experience position</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">frame as [nested] dictionary</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-btgym.algorithms.memory">
<span id="btgym-algorithms-memory-module"></span><h2>btgym.algorithms.memory module<a class="headerlink" href="#module-btgym.algorithms.memory" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="btgym.algorithms.memory.Memory">
<em class="property">class </em><code class="descclassname">btgym.algorithms.memory.</code><code class="descname">Memory</code><span class="sig-paren">(</span><em>history_size</em>, <em>max_sample_size</em>, <em>priority_sample_size</em>, <em>log_level=13</em>, <em>rollout_provider=None</em>, <em>task=-1</em>, <em>reward_threshold=0.1</em>, <em>use_priority_sampling=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory" title="Permalink to this definition">¶</a></dt>
<dd><p>Replay memory with rebalanced replay based on reward value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">must be filled up before calling sampling methods.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>history_size</strong> – number of experiences stored;</li>
<li><strong>max_sample_size</strong> – maximum allowed sample size (e.g. off-policy rollout length);</li>
<li><strong>priority_sample_size</strong> – sample size of priority_sample() method</li>
<li><strong>log_level</strong> – int, logbook.level;</li>
<li><strong>rollout_provider</strong> – callable returning list of Rollouts NOT USED</li>
<li><strong>task</strong> – parent worker id;</li>
<li><strong>reward_threshold</strong> – if <a href="#id7"><span class="problematic" id="id8">|experience.reward|</span></a> &gt; reward_threshold: experience is saved as ‘prioritized’;</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="btgym.algorithms.memory.Memory.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>frame</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory.add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends single experience frame to memory.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>frame</strong> – dictionary of values.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.memory.Memory.add_rollout">
<code class="descname">add_rollout</code><span class="sig-paren">(</span><em>rollout</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory.add_rollout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory.add_rollout" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds frames from given rollout to memory with respect to episode continuation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rollout</strong> – <cite>Rollout</cite> instance.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.memory.Memory.fill">
<code class="descname">fill</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory.fill"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory.fill" title="Permalink to this definition">¶</a></dt>
<dd><p>Fills replay memory with initial experiences. NOT USED.
Supposed to be called by parent worker() just before training begins.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rollout_getter</strong> – callable, returning list of Rollouts.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.memory.Memory.sample_uniform">
<code class="descname">sample_uniform</code><span class="sig-paren">(</span><em>sequence_size</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory.sample_uniform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory.sample_uniform" title="Permalink to this definition">¶</a></dt>
<dd><p>Uniformly samples sequence of successive frames of size <cite>sequence_size</cite> or less (~off-policy rollout).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sequence_size</strong> – maximum sample size.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">instance of Rollout of size &lt;= sequence_size.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.algorithms.memory.Memory._sample_priority">
<code class="descname">_sample_priority</code><span class="sig-paren">(</span><em>size=None</em>, <em>exact_size=False</em>, <em>skewness=2</em>, <em>sample_attempts=100</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/memory.html#Memory._sample_priority"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.memory.Memory._sample_priority" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements rebalanced replay.
Samples sequence of successive frames from distribution skewed by means of reward of last sample frame.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>size</strong> – sample size, must be &lt;= self.max_sample_size;</li>
<li><strong>exact_size</strong> – whether accept sample with size less than ‘size’
or re-sample to get sample of exact size (used for reward prediction task);</li>
<li><strong>skewness</strong> – int&gt;=1, sampling probability denominator, such as probability of sampling sequence with
last frame having non-zero reward is: p[non_zero]=1/skewness;</li>
<li><strong>sample_attempts</strong> – if exact_size=True, sets number of re-sampling attempts
to get sample of continuous experiences (no <cite>Terminal</cite> frames inside except last one);
if number is reached - sample returned ‘as is’.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">instance of Rollout().</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-btgym.algorithms.envs">
<span id="btgym-algorithms-envs-module"></span><h2>btgym.algorithms.envs module<a class="headerlink" href="#module-btgym.algorithms.envs" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="btgym.algorithms.envs.AtariRescale42x42">
<em class="property">class </em><code class="descclassname">btgym.algorithms.envs.</code><code class="descname">AtariRescale42x42</code><span class="sig-paren">(</span><em>env_id=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/envs.html#AtariRescale42x42"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.envs.AtariRescale42x42" title="Permalink to this definition">¶</a></dt>
<dd><p>Gym wrapper, pipes Atari into BTgym algorithms, as later expect observations to be DictSpace.
Makes Atari environment return state as dictionary with single key ‘external’ holding
normalized in [0,1] grayscale 42x42 visual output.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>env_id</strong> – conventional Gym id.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-btgym.algorithms.runner">
<span id="btgym-algorithms-runner-module"></span><h2>btgym.algorithms.runner module<a class="headerlink" href="#module-btgym.algorithms.runner" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="btgym.algorithms.runner.RunnerThread">
<em class="property">class </em><code class="descclassname">btgym.algorithms.runner.</code><code class="descname">RunnerThread</code><span class="sig-paren">(</span><em>env</em>, <em>policy</em>, <em>task</em>, <em>rollout_length</em>, <em>episode_summary_freq</em>, <em>env_render_freq</em>, <em>test</em>, <em>ep_summary</em>, <em>memory_config=None</em>, <em>log_level=13</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/runner.html#RunnerThread"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.runner.RunnerThread" title="Permalink to this definition">¶</a></dt>
<dd><p>Async. framework code comes from OpenAI repository under MIT licence:
<a class="reference external" href="https://github.com/openai/universe-starter-agent">https://github.com/openai/universe-starter-agent</a></p>
<p>Despite the fact BTgym is not real-time environment [yet], thread-runner approach is still here. From
original <cite>universe-starter-agent</cite>:
<cite>…One of the key distinctions between a normal environment and a universe environment
is that a universe environment is _real time_.  This means that there should be a thread
that would constantly interact with the environment and tell it what to do.  This thread is here.</cite></p>
<p>Another idea is to see ThreadRunner as all-in-one data provider, thus shaping data distribution
fed to estimator from single place.
So, replay memory is also here, as well as some service functions (collecting summary data).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>env</strong> – environment instance</li>
<li><strong>policy</strong> – policy instance</li>
<li><strong>task</strong> – int</li>
<li><strong>rollout_length</strong> – int</li>
<li><strong>episode_summary_freq</strong> – int</li>
<li><strong>env_render_freq</strong> – int</li>
<li><strong>test</strong> – Atari or BTGyn</li>
<li><strong>ep_summary</strong> – tf.summary</li>
<li><strong>memory_config</strong> – replay memory configuration dictionary</li>
<li><strong>log_level</strong> – int, logbook.level</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="btgym.algorithms.runner.RunnerThread.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/runner.html#RunnerThread.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.runner.RunnerThread.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Just keep running.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="btgym.algorithms.runner.env_runner">
<code class="descclassname">btgym.algorithms.runner.</code><code class="descname">env_runner</code><span class="sig-paren">(</span><em>sess</em>, <em>env</em>, <em>policy</em>, <em>task</em>, <em>rollout_length</em>, <em>summary_writer</em>, <em>episode_summary_freq</em>, <em>env_render_freq</em>, <em>atari_test</em>, <em>ep_summary</em>, <em>memory_config</em>, <em>log</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/algorithms/runner.html#env_runner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.algorithms.runner.env_runner" title="Permalink to this definition">¶</a></dt>
<dd><p>The logic of the thread runner.
In brief, it constantly keeps on running
the policy, and as long as the rollout exceeds a certain length, the thread
runner appends all the collected data to the queue.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>env</strong> – environment instance</li>
<li><strong>policy</strong> – policy instance</li>
<li><strong>task</strong> – int</li>
<li><strong>rollout_length</strong> – int</li>
<li><strong>episode_summary_freq</strong> – int</li>
<li><strong>env_render_freq</strong> – int</li>
<li><strong>atari_test</strong> – bool, Atari or BTGyn</li>
<li><strong>ep_summary</strong> – dict of tf.summary op and placeholders</li>
<li><strong>memory_config</strong> – replay memory configuration dictionary</li>
<li><strong>log</strong> – logbook logger</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Yelds:</dt>
<dd>collected data as dictionary of on_policy, off_policy rollouts and episode statistics.</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="btgym.research.html" class="btn btn-neutral float-right" title="btgym.research package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="btgym.datafeed.html" class="btn btn-neutral" title="btgym.datafeed package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Andrew Muzikin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>